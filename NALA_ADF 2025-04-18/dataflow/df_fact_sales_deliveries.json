{
	"name": "df_fact_sales_deliveries",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_parquet",
						"type": "DatasetReference"
					},
					"name": "SrcCustPackingSlipTrans"
				},
				{
					"dataset": {
						"referenceName": "ds_snowflake",
						"type": "DatasetReference"
					},
					"name": "SrcCustPackingSlipTransExt"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_snowflake",
						"type": "DatasetReference"
					},
					"name": "CustPackingSlipTrans"
				},
				{
					"dataset": {
						"referenceName": "ds_snowflake",
						"type": "DatasetReference"
					},
					"name": "CustPackingSlipTransExt"
				}
			],
			"transformations": [
				{
					"name": "JoinColumns"
				},
				{
					"name": "SetActiveFlag"
				},
				{
					"name": "PullDistinctEntries"
				},
				{
					"name": "UpsertCustPackingSlipTransExt"
				}
			],
			"scriptLines": [
				"parameters{",
				"     df_prev_max_timestamp as string",
				"}",
				"source(output(",
				"          RECID as long,",
				"          DEFAULTDIMENSION as long,",
				"          TRANSACTIONCODE as string,",
				"          INVENTDIMID as string,",
				"          ITEMID as string,",
				"          DELIVERYPOSTALADDRESS as long,",
				"          SALESGROUP as string,",
				"          SALESUNIT as string,",
				"          DELIVERYDATE as timestamp,",
				"          SALESLINESHIPPINGDATECONFIRMED as timestamp,",
				"          SALESLINESHIPPINGDATEREQUESTED as timestamp,",
				"          INVENTTRANSID as string,",
				"          DATAAREAID as string,",
				"          LINENUM as decimal(32,16),",
				"          ORIGSALESID as string,",
				"          PACKINGSLIPID as string,",
				"          SALESID as string,",
				"          DELIVERYTYPE as integer,",
				"          INVENTQTY as decimal(32,16),",
				"          QTY as decimal(32,16),",
				"          PRICEUNIT as decimal(32,16),",
				"          VALUEMST as decimal(32,16),",
				"          MODIFIEDDATETIME as timestamp,",
				"          DEFAULTDIMENSION_BUSINESS_UNIT as string,",
				"          DEFAULTDIMENSION_MODIFIEDDATETIME as timestamp,",
				"          SALESTABLE_SMMCAMPAIGNID as string,",
				"          SALESTABLE_MARKUPGROUP as string,",
				"          SALESTABLE_LINEDISC as string,",
				"          SALESTABLE_SALESPOOLID as string,",
				"          SALESTABLE_PRICEGROUPID as string,",
				"          SALESTABLE_WORKERSALESRESPONSIBLE as long,",
				"          SALESTABLE_DOCUMENTSTATUS as integer,",
				"          SALESTABLE_RETURNSTATUS as integer,",
				"          SALESTABLE_SALESSTATUS as integer,",
				"          SALESTABLE_SALESTYPE as integer,",
				"          SALESTABLE_ATAGENT as integer,",
				"          SALESTABLE_SHIPCARRIERBLINDSHIPMENT as integer,",
				"          SALESTABLE_SHIPCARRIEREXPEDITEDSHIPMENT as integer,",
				"          SALESTABLE_ORDERBLOCKED as integer,",
				"          SALESTABLE_MCRORDERSTOPPED as integer,",
				"          SALESTABLE_SHIPCARRIERFUELSURCHARGE as integer,",
				"          SALESTABLE_MODIFIEDDATETIME as timestamp,",
				"          CUSTPACKINGSLIPJOUR_INVOICEACCOUNT as string,",
				"          CUSTPACKINGSLIPJOUR_ORDERACCOUNT as string,",
				"          CUSTPACKINGSLIPJOUR_DLVMODE as string,",
				"          CUSTPACKINGSLIPJOUR_DLVTERM as string,",
				"          CUSTPACKINGSLIPJOUR_INVOICEPOSTALADDRESS as long,",
				"          CUSTPACKINGSLIPJOUR_SHIPCARRIERID as string,",
				"          CUSTPACKINGSLIPJOUR_INVENTLOCATIONID as string,",
				"          CUSTPACKINGSLIPJOUR_WORKERSALESTAKER as long,",
				"          CUSTPACKINGSLIPJOUR_NTT_DELIVERYSTATUS as integer,",
				"          CUSTPACKINGSLIPJOUR_DOCUMENTDATE as timestamp,",
				"          CUSTPACKINGSLIPJOUR_BILLOFLADINGID as string,",
				"          CUSTPACKINGSLIPJOUR_INTERNALPACKINGSLIPID as string,",
				"          CUSTPACKINGSLIPJOUR_LEDGERVOUCHER as string,",
				"          CUSTPACKINGSLIPJOUR_PURCHASEORDER as string,",
				"          CUSTPACKINGSLIPJOUR_EBCOVERRIDESTATUS as string,",
				"          CUSTPACKINGSLIPJOUR_MODIFIEDDATETIME as timestamp,",
				"          INVENTDIM1_CONFIGID as string,",
				"          INVENTDIM1_MODIFIEDDATETIME as timestamp,",
				"          INVENTDIMCOMBINATION_PDMSTATUS as long,",
				"          INVENTDIMCOMBINATION_MODIFIEDDATETIME as timestamp,",
				"          SHIPCARRIERPACKAGE1_ORIG_CARRIERID as string,",
				"          SHIPCARRIERPACKAGE1_ORIG_SHIPDATE as timestamp,",
				"          SHIPCARRIERPACKAGE1_ORIG_CARRIERNAME as string,",
				"          SHIPCARRIERPACKAGE2_SHIPDATE as timestamp,",
				"          SALESLINE_LINEDISC as decimal(32,16),",
				"          SALESLINE_LINEPERCENT as decimal(32,16),",
				"          SALESLINE_RETURNSTATUS as integer,",
				"          SALESLINE_SALESSTATUS as string,",
				"          SALESLINE_SHIPCARRIERDLVTYPE as integer,",
				"          SALESLINE_COMPLETE as integer,",
				"          SALESLINE_ORDERBLOCKED as integer,",
				"          SALESLINE_SCRAP as integer,",
				"          SALESLINE_STOCKEDPRODUCT as integer,",
				"          SALESLINE_MODIFIEDDATETIME as timestamp,",
				"          MCRSALESLINEDROPSHIPMENT_DROPSHIPMENT as integer,",
				"          SHIPCARRIERTRACKING_NTT_DELIVERYDATE as timestamp,",
				"          SHIPCARRIERTRACKING_TRACKINGNUMBER as string,",
				"          TIMEXTENDERENUMTABLE1_ENUMVALUELABEL_DOCUMENTSTATUS as string,",
				"          TIMEXTENDERENUMTABLE2_ENUMVALUELABEL_RETURNSTATUSHEADER as string,",
				"          TIMEXTENDERENUMTABLE3_ENUMVALUELABEL_SALESSTATUSHEADER as string,",
				"          TIMEXTENDERENUMTABLE4_ENUMVALUELABEL_RETURNSTATUSLINE as string,",
				"          TIMEXTENDERENUMTABLE5_ENUMVALUELABEL_SALESSTATUSLINE as string,",
				"          TIMEXTENDERENUMTABLE6_ENUMVALUELABEL_SALESTYPE as string,",
				"          TIMEXTENDERENUMTABLE7_ENUMVALUELABEL_SHIPCARRIERDLVTYPE as string,",
				"          TIMEXTENDERENUMTABLE8_ENUMVALUELABEL_NTT_DELIVERYSTATUS as string,",
				"          TIMEXTENDERENUMTABLE9_ENUMVALUELABEL_TRADELINEDLVTYPE as string,",
				"          PDMSTATUS_NAME as string,",
				"          HK_CUSTPACKINGSLIPTRANS_EXT_HASH_KEY as string,",
				"          LATEST_MODIFIEDDATETIME as timestamp,",
				"          HK_JOB_RUN_ID as string,",
				"          HK_SOURCE_NAME as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     format: 'parquet') ~> SrcCustPackingSlipTrans",
				"source(output(",
				"          HK_SOURCE_NAME as string,",
				"          HK_JOB_RUN_ID as string,",
				"          HK_CREATED_TIMESTAMP as timestamp,",
				"          HK_WAREHOUSE_ID as string,",
				"          HK_CUSTPACKINGSLIPTRANS_EXT_HASH_KEY as string,",
				"          RECID as long,",
				"          SHIPCARRIERPACKAGE1_ORIG_CARRIERID as string,",
				"          SHIPCARRIERPACKAGE1_ORIG_SHIPDATE as date,",
				"          SHIPCARRIERPACKAGE1_ORIG_CARRIERNAME as string,",
				"          SHIPCARRIERPACKAGE2_SHIPDATE as date,",
				"          MCRSALESLINEDROPSHIPMENT_DROPSHIPMENT as decimal(38,0),",
				"          SHIPCARRIERTRACKING_NTT_DELIVERYDATE as date,",
				"          SHIPCARRIERTRACKING_TRACKINGNUMBER as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'table') ~> SrcCustPackingSlipTransExt",
				"SrcCustPackingSlipTrans, SrcCustPackingSlipTransExt join(SrcCustPackingSlipTrans@RECID == SrcCustPackingSlipTransExt@RECID,",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> JoinColumns",
				"JoinColumns derive(ACTIVE_FLAG = iif((SrcCustPackingSlipTrans@RECID == SrcCustPackingSlipTransExt@RECID && SrcCustPackingSlipTrans@HK_CUSTPACKINGSLIPTRANS_EXT_HASH_KEY == toString(SrcCustPackingSlipTransExt@HK_CUSTPACKINGSLIPTRANS_EXT_HASH_KEY) && LATEST_MODIFIEDDATETIME <= toTimestamp($df_prev_max_timestamp)) , 'R',\r",
				"iif((SrcCustPackingSlipTrans@RECID == SrcCustPackingSlipTransExt@RECID && SrcCustPackingSlipTrans@HK_CUSTPACKINGSLIPTRANS_EXT_HASH_KEY == toString(SrcCustPackingSlipTransExt@HK_CUSTPACKINGSLIPTRANS_EXT_HASH_KEY) && LATEST_MODIFIEDDATETIME > toTimestamp($df_prev_max_timestamp)) || (SrcCustPackingSlipTrans@RECID == SrcCustPackingSlipTransExt@RECID && SrcCustPackingSlipTrans@HK_CUSTPACKINGSLIPTRANS_EXT_HASH_KEY != toString(SrcCustPackingSlipTransExt@HK_CUSTPACKINGSLIPTRANS_EXT_HASH_KEY)), 'U','I'))) ~> SetActiveFlag",
				"SetActiveFlag filter(ACTIVE_FLAG != 'R') ~> PullDistinctEntries",
				"PullDistinctEntries alterRow(updateIf(ACTIVE_FLAG=='U'),",
				"     insertIf(ACTIVE_FLAG=='I')) ~> UpsertCustPackingSlipTransExt",
				"PullDistinctEntries sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     stageInsert: true,",
				"     mapColumn(",
				"          RECID = SrcCustPackingSlipTrans@RECID,",
				"          DEFAULTDIMENSION,",
				"          TRANSACTIONCODE,",
				"          INVENTDIMID,",
				"          ITEMID,",
				"          DELIVERYPOSTALADDRESS,",
				"          SALESGROUP,",
				"          SALESUNIT,",
				"          DELIVERYDATE,",
				"          SALESLINESHIPPINGDATECONFIRMED,",
				"          SALESLINESHIPPINGDATEREQUESTED,",
				"          INVENTTRANSID,",
				"          DATAAREAID,",
				"          LINENUM,",
				"          ORIGSALESID,",
				"          PACKINGSLIPID,",
				"          SALESID,",
				"          INVENTQTY,",
				"          QTY,",
				"          PRICEUNIT,",
				"          VALUEMST,",
				"          MODIFIEDDATETIME,",
				"          DEFAULTDIMENSION_BUSINESS_UNIT,",
				"          DEFAULTDIMENSION_MODIFIEDDATETIME,",
				"          SALESTABLE_SMMCAMPAIGNID,",
				"          SALESTABLE_MARKUPGROUP,",
				"          SALESTABLE_LINEDISC,",
				"          SALESTABLE_SALESPOOLID,",
				"          SALESTABLE_PRICEGROUPID,",
				"          SALESTABLE_WORKERSALESRESPONSIBLE,",
				"          SALESTABLE_DOCUMENTSTATUS,",
				"          SALESTABLE_RETURNSTATUS,",
				"          SALESTABLE_SALESSTATUS,",
				"          SALESTABLE_SALESTYPE,",
				"          SALESTABLE_ATAGENT,",
				"          SALESTABLE_SHIPCARRIERBLINDSHIPMENT,",
				"          SALESTABLE_SHIPCARRIEREXPEDITEDSHIPMENT,",
				"          SALESTABLE_ORDERBLOCKED,",
				"          SALESTABLE_MCRORDERSTOPPED,",
				"          SALESTABLE_SHIPCARRIERFUELSURCHARGE,",
				"          SALESTABLE_MODIFIEDDATETIME,",
				"          CUSTPACKINGSLIPJOUR_INVOICEACCOUNT,",
				"          CUSTPACKINGSLIPJOUR_ORDERACCOUNT,",
				"          CUSTPACKINGSLIPJOUR_DLVMODE,",
				"          CUSTPACKINGSLIPJOUR_DLVTERM,",
				"          CUSTPACKINGSLIPJOUR_INVOICEPOSTALADDRESS,",
				"          CUSTPACKINGSLIPJOUR_SHIPCARRIERID,",
				"          CUSTPACKINGSLIPJOUR_INVENTLOCATIONID,",
				"          CUSTPACKINGSLIPJOUR_WORKERSALESTAKER,",
				"          CUSTPACKINGSLIPJOUR_NTT_DELIVERYSTATUS,",
				"          CUSTPACKINGSLIPJOUR_DOCUMENTDATE,",
				"          CUSTPACKINGSLIPJOUR_BILLOFLADINGID,",
				"          CUSTPACKINGSLIPJOUR_INTERNALPACKINGSLIPID,",
				"          CUSTPACKINGSLIPJOUR_LEDGERVOUCHER,",
				"          CUSTPACKINGSLIPJOUR_PURCHASEORDER,",
				"          CUSTPACKINGSLIPJOUR_EBCOVERRIDESTATUS,",
				"          CUSTPACKINGSLIPJOUR_MODIFIEDDATETIME,",
				"          INVENTDIM1_CONFIGID,",
				"          INVENTDIM1_MODIFIEDDATETIME,",
				"          INVENTDIMCOMBINATION_PDMSTATUS,",
				"          INVENTDIMCOMBINATION_MODIFIEDDATETIME,",
				"          SHIPCARRIERPACKAGE1_ORIG_CARRIERID = SrcCustPackingSlipTrans@SHIPCARRIERPACKAGE1_ORIG_CARRIERID,",
				"          SHIPCARRIERPACKAGE1_ORIG_SHIPDATE = SrcCustPackingSlipTrans@SHIPCARRIERPACKAGE1_ORIG_SHIPDATE,",
				"          SHIPCARRIERPACKAGE1_ORIG_CARRIERNAME = SrcCustPackingSlipTrans@SHIPCARRIERPACKAGE1_ORIG_CARRIERNAME,",
				"          SHIPCARRIERPACKAGE2_SHIPDATE = SrcCustPackingSlipTrans@SHIPCARRIERPACKAGE2_SHIPDATE,",
				"          SALESLINE_LINEDISC,",
				"          SALESLINE_LINEPERCENT,",
				"          SALESLINE_RETURNSTATUS,",
				"          SALESLINE_SALESSTATUS,",
				"          SALESLINE_SHIPCARRIERDLVTYPE,",
				"          SALESLINE_COMPLETE,",
				"          SALESLINE_ORDERBLOCKED,",
				"          SALESLINE_SCRAP,",
				"          SALESLINE_STOCKEDPRODUCT,",
				"          SALESLINE_MODIFIEDDATETIME,",
				"          MCRSALESLINEDROPSHIPMENT_DROPSHIPMENT = SrcCustPackingSlipTrans@MCRSALESLINEDROPSHIPMENT_DROPSHIPMENT,",
				"          SHIPCARRIERTRACKING_NTT_DELIVERYDATE = SrcCustPackingSlipTrans@SHIPCARRIERTRACKING_NTT_DELIVERYDATE,",
				"          SHIPCARRIERTRACKING_TRACKINGNUMBER = SrcCustPackingSlipTrans@SHIPCARRIERTRACKING_TRACKINGNUMBER,",
				"          TIMEXTENDERENUMTABLE1_ENUMVALUELABEL_DOCUMENTSTATUS,",
				"          TIMEXTENDERENUMTABLE2_ENUMVALUELABEL_RETURNSTATUSHEADER,",
				"          TIMEXTENDERENUMTABLE3_ENUMVALUELABEL_SALESSTATUSHEADER,",
				"          TIMEXTENDERENUMTABLE4_ENUMVALUELABEL_RETURNSTATUSLINE,",
				"          TIMEXTENDERENUMTABLE5_ENUMVALUELABEL_SALESSTATUSLINE,",
				"          TIMEXTENDERENUMTABLE6_ENUMVALUELABEL_SALESTYPE,",
				"          TIMEXTENDERENUMTABLE7_ENUMVALUELABEL_SHIPCARRIERDLVTYPE,",
				"          TIMEXTENDERENUMTABLE8_ENUMVALUELABEL_NTT_DELIVERYSTATUS,",
				"          TIMEXTENDERENUMTABLE9_ENUMVALUELABEL_TRADELINEDLVTYPE,",
				"          LATEST_MODIFIEDDATETIME,",
				"          HK_JOB_RUN_ID = SrcCustPackingSlipTrans@HK_JOB_RUN_ID,",
				"          HK_SOURCE_NAME = SrcCustPackingSlipTrans@HK_SOURCE_NAME,",
				"          PDMSTATUS_NAME",
				"     )) ~> CustPackingSlipTrans",
				"UpsertCustPackingSlipTransExt sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:true,",
				"     upsertable:false,",
				"     keys:['RECID'],",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     stageInsert: true,",
				"     mapColumn(",
				"          RECID = SrcCustPackingSlipTrans@RECID,",
				"          SHIPCARRIERPACKAGE1_ORIG_CARRIERID = SrcCustPackingSlipTrans@SHIPCARRIERPACKAGE1_ORIG_CARRIERID,",
				"          SHIPCARRIERPACKAGE1_ORIG_SHIPDATE = SrcCustPackingSlipTrans@SHIPCARRIERPACKAGE1_ORIG_SHIPDATE,",
				"          SHIPCARRIERPACKAGE1_ORIG_CARRIERNAME = SrcCustPackingSlipTrans@SHIPCARRIERPACKAGE1_ORIG_CARRIERNAME,",
				"          SHIPCARRIERPACKAGE2_SHIPDATE = SrcCustPackingSlipTrans@SHIPCARRIERPACKAGE2_SHIPDATE,",
				"          MCRSALESLINEDROPSHIPMENT_DROPSHIPMENT = SrcCustPackingSlipTrans@MCRSALESLINEDROPSHIPMENT_DROPSHIPMENT,",
				"          SHIPCARRIERTRACKING_NTT_DELIVERYDATE = SrcCustPackingSlipTrans@SHIPCARRIERTRACKING_NTT_DELIVERYDATE,",
				"          SHIPCARRIERTRACKING_TRACKINGNUMBER = SrcCustPackingSlipTrans@SHIPCARRIERTRACKING_TRACKINGNUMBER,",
				"          HK_CUSTPACKINGSLIPTRANS_EXT_HASH_KEY = SrcCustPackingSlipTrans@HK_CUSTPACKINGSLIPTRANS_EXT_HASH_KEY,",
				"          HK_JOB_RUN_ID = SrcCustPackingSlipTrans@HK_JOB_RUN_ID,",
				"          HK_SOURCE_NAME = SrcCustPackingSlipTrans@HK_SOURCE_NAME",
				"     )) ~> CustPackingSlipTransExt"
			]
		}
	}
}